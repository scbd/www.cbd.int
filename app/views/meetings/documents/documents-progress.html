<div>
    <style>

        .document-status .progress                 { border-radius: 0px; margin-bottom:5px; }
        .document-status .progress-bar             { border-right: dotted 1px black; }
        .document-status .progress-bar:last-child  { border-right: none; }
        .document-status .progress-bar-na          { background-color: gray; }
        .document-status .progress-bar.skipped     { text-decoration: line-through; background-color: lightgray; }
    </style>

    <div class="panel panel-default">
        <div class="panel-heading">
            Filters
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-xs-6 col-sm-3">
                    <label>
                        Assigned to me <input type="checkbox" ng-model="statusCtrl.filters.assignedToMe"> 
                    </label>
                </div>
                <div class="col-xs-6 col-sm-3">
                    <label>
                        Overdue <input type="checkbox" ng-model="statusCtrl.filters.overdue"> 
                    </label>
                </div>

                <div class="col-xs-12 col-sm-3">
                    <select class="form-control" ng-model="statusCtrl.filters.type_nature">
                        <option value="">All documents</option>
                        <option value="official">Official</option>
                        <option value="in-session">In-Session (All)</option>
                        <option value="in-session/non-paper">Non Paper (In-Session)</option>
                        <option value="in-session/crp">CRP (In-Session)</option>
                        <option value="in-session/limited">L (In-Session)</option>
                    </select>
                </div>

                <div class="col-xs-12 col-sm-3">
                    <select class="form-control" ng-model="statusCtrl.filters.status">
                        <option value="">All status</option>
                        <option value="public">Public</option>
                        <option value="!public">Not public</option>
                    </select>
                </div>
            </div>
        </div>
    </div>    

    <table class="document-status table table-striped table-hover table-condensed">
        <tr>
            <th class="hidden-xs">Symbol</th>
            <th class="hidden-xs">Owner</th>
            <th>Status</th>
            <th></th>
        <tr ng-repeat="d in statusCtrl.documents|filter:statusCtrl.filters.assignedToFilter|filter:statusCtrl.filters.dueFilter|filter:statusCtrl.filters.documentTypeFilter|filter:statusCtrl.filters.statusFilter" ng-class="{ success:d.status=='public'}">
            <td class="hidden-xs" style="width:1%">
                <div class="text-nowrap">
                    <span ng-repeat="item in ::d.agendaItems" class="label agenda {{::statusCtrl.meeting.agenda.prefix}}">{{::statusCtrl.meeting.agenda.prefix}} {{item}}</span> 
                    <strong class="text-nowrap">{{d.symbol}}</strong>
                </div>
                <div ng-if="d.expanded" title="{{d.title|lstring}}">{{d.title|lstring}}</div>
                <a ng-if="d.workflow.activeStep.inRevision" target="_blank" href="{{d.workflow.files[d.workflow.activeStep.inRevision-1].url}}"> Latest revision v{{d.workflow.activeStep.inRevision}}</a>
            </td>
            <td class="hidden-xs text-nowrap" style="width:1%">
                
                <div ng-if="d.workflow.newOwners">
                    <select-user ng-if="d.workflow.newOwners" caption="Assign to" role="1275" ng-model="_selectedUser" ng-change="d.workflow.newOwners.push(_selectedUser)"></select-user>
                    <button type="button" class="btn btn-link btn-xs" ng-click="statusCtrl.updateWorkflow(d, { owners : statusCtrl.toIDs(d.workflow.newOwners) })"><i class="fa fa-check"></i></button>
                    <button type="button" class="btn btn-link btn-xs" ng-click="d.workflow.newOwners=null"><i class="fa fa-times"></i></button>

                    <div ng-repeat="o in d.workflow.newOwners">
                        <button type="button" class="btn btn-link btn-xs btn-danger" ng-click="d.workflow.newOwners.splice(d.workflow.newOwners.indexOf(o),1)"><i class="fa fa-times"></i></button>
                        <span title="{{o.firstName}} {{o.lastName}}">{{o|initials}}<span ng-if="!$last">, </span></span>
                    </div>
                </div>
                
                <div ng-if="!d.workflow.newOwners">
                    <span ng-repeat="o in d.workflow.owners" title="{{o.firstName}} {{o.lastName}}">{{o|initials}}<span ng-if="!$last">, </span></span>
                    <button ng-if="d.workflow.canEdit" class="btn btn-link" ng-click="d.workflow.newOwners = (d.workflow.owners||[]).slice(0)"><i class="fa fa-edit"></i></button>
                </div>

            </td>
            <td ng-click="d.expanded=true" style="position:relative">
                
                <div style="position:absolute;height:100%;left:50%;top:0px;border-right:dotted 2px red" title="Today">
                    &nbsp;
                </div>
                
                <div class="visible-xs">                
                    <span ng-repeat="item in ::d.agendaItems" class="label agenda {{::statusCtrl.meeting.agenda.prefix}}">{{::statusCtrl.meeting.agenda.prefix}} {{item}}</span> 
                    <strong>{{d.symbol}}</strong>
                    <span ng-repeat="o in d.workflow.owners" title="{{o.firstName}} {{o.lastName}}">
                        <span ng-if="$first"> - </span>
                        {{o|initials}}
                        <span ng-if="!$last">, </span>
                    </span>

                    <div ng-if="d.expanded" title="{{d.title|lstring}}">{{d.title|lstring}}</div>
                </div>

            
                <div  ng-if="d.workflow.steps.length && (d.status!='public' || !d.files.length)" class="progress"  style="width:50%;margin-left:{{50-d.workflow.progress/2}}%;height:25px;display:inline-block">
                    <div ng-repeat="s in d.workflow.steps" title="Due: {{s.dueDate|moment:'format':'DD MMMM YYYY'}} - {{s.dueDate|moment:'fromNow'}}" 
                    class="progress-bar {{s.status}}" 
                    ng-class="{ 'progress-bar-na': ((s.status=='pending' && s.dueDate>=TODAY) || s.status=='skipped'), 'progress-bar-success': s.status=='completed', 'progress-bar-info': s.status=='active',  'progress-bar-danger': ((s.status=='active'||s.status=='pending') && s.dueDate<TODAY) }" 
                    style="width: {{100/d.workflow.steps.length}}%;">
                        {{s.type}}
                    </div>
                </div>       
                <div ng-if="d.status=='public'" class='text-right'>
                    <document-files files="d.files"></document-files>
                </div>
                
                
                <div ng-if="d.expanded">
                    <div class="row">
                    <div class="col-md-12">
                        <document-progress-steps document="d" documents="statusCtrl.documents"></document-progress-steps>
                    </div>
                    
                    <div class="col-md-12">
                        <table class="document-status table table-condensed" style="max-heigth:600px;overflow-y:scroll">
                            <tr ng-click="d.logs ? d.logs=null : statusCtrl.loadLogs(d)">
                                <th colspan="2">Events</th>
                                <th colspan="1" class="text-right" >
                                    <i ng-show="d.logs" class="fa fa-caret-up"></i>
                                    <i ng-hide="d.logs" class="fa fa-caret-down"></i>
                                </th>
                            </tr>
                            <tr ng-repeat="log in d.logs | orderBy:'date':true">
                                <td class="text-nowrap" title="{{log.date|date:'yyyy-MM-dd HH:mm.ss'}}">{{log.date|moment:'fromNow':true}}</td>
                                <td class="text-nowrap" title="{{log.user.name}}">{{log.user|initials}}</td>
                                <td style="width:99%">{{log.text}}</td>
                            </tr>
                        </table>
                    </div>
                    </div>
                </div>
            </td>
            <td style="width:1%" ng-click="d.expanded = !d.expanded">
                <i ng-show="d.expanded" class="fa fa-caret-up"></i>
                <i ng-hide="d.expanded" class="fa fa-caret-down"></i>
            </td>
        </tr>
    </table>

    <file-drop ng-model="_file" ng-change="statusCtrl.onFile(_file)" auto-reset="true"></file-drop>

</div>
